function createGraph(){return cytoscape({container:document.getElementById("cy"),style:[{selector:".graphNode",style:{"background-fit":"cover cover","background-color":"white",label:"data(id)","text-valign":"bottom"}},{selector:".computeNode",style:{"background-image":"images/pc.png"}},{selector:".loadBalancer",style:{"background-image":"images/lb.png"}},{selector:".router",style:{"background-image":"images/router.png"}},{selector:".switch",style:{"background-image":"images/switch.png"}},{selector:".acl",style:{"background-image":"images/acl.png"}},{selector:".internet",style:{"background-image":"images/world.png"}},{selector:".subnet",style:{"background-image":"images/cloud.png"}},{selector:".gateway",style:{"background-image":"images/gateway.png"}},{selector:".application",style:{"background-image":"images/application.png"}},{selector:".firewall",style:{"background-image":"images/firewall.png"}},{selector:".policyAllow",style:{"background-image":"images/policyAllow.png"}},{selector:".policyDeny",style:{"background-image":"images/policyDeny.png"}},{selector:".policy",style:{"background-image":"images/policy.png"}},{selector:".group",style:{"background-image":"images/group.png",shape:"rectangle"}}]})}var cy=createGraph(),lastCommand="",stompClient=null,hasAlert=!1,hasUnknown=!1;function connect(){var t=new SockJS("/intent-websocket");(stompClient=Stomp.over(t)).connect({},function(t){console.log("Connected: "+t),stompClient.subscribe("/topic/hint",function(t){var n=JSON.parse(t.body);"DONE"==n.status?sendIntent(n):"LOCAL"==n.status?doLocal(n):"INFO"==n.status?doInfo(n):"ERROR"==n.status?showAlert(n.hint):inputTextHint(n.hint)}),stompClient.subscribe("/topic/graph",function(t){addToGraph(JSON.parse(t.body))})})}function disconnect(){null!==stompClient&&stompClient.disconnect(),setConnected(!1),console.log("Disconnected")}function doLocal(t){switch(t.intent){case"clear":cy.destroy(),console.log("graph destroyed"),cy=createGraph();break;case"disconnectNodes":var n="#"+t.params.id;cy.$(n).remove();break;case"deleteNode":var e="#"+t.params.id;cy.$(e).remove();break;default:console.log("unknown local intent")}}function sendinfo(t){var n=$("#info");n.css("z-index","-1"),n.css("opacity","0"),n.css("bottom","0%"),stompClient.send("/app/getHint",{},JSON.stringify(t))}function doInfo(t){if("option"==t.params.type){(s=$("#info")).text(t.params.question+"  ");var n=null,e=t.params.options.split(",");for(var o in e){var a=e[o];n=$("<button/>",{text:a,id:"btn_"+o,click:function(){t.params[t.params.param]=this.textContent,sendinfo(t)}}),s.append(n)}s.css("opacity","1"),s.css("bottom","125%"),s.css("z-index","2")}else if("yesno"==t.params.type){(s=$("#info")).text(t.params.question+"  ");n=null;n=$("<button/>",{text:"yes",id:"btn_yes",click:function(){t.params[t.params.param]="yes",sendinfo(t)}}),s.append(n),n=$("<button/>",{text:"no",id:"btn_no",click:function(){t.params[t.params.param]="no",sendinfo(t)}}),s.append(n),s.css("opacity","1"),s.css("bottom","125%"),s.css("z-index","2")}else if("unknownRequest"==t.params.type){var s;(s=$("#info")).text(t.params.question),s.css("opacity","1"),s.css("bottom","125%"),s.css("z-index","2"),hasUnknown=!0}}function addToGraph(t){cy.add(t),cy.layout({name:"breadthfirst"}).run()}function getHintFromWit(t){$.ajax({url:"https://api.wit.ai/message",data:{q:t,access_token:"ZXSURWM4YGEVFFV6QENTBUK6PXUV2TBR"},dataType:"jsonp",method:"GET",success:function(t){console.log("success!",t)}})}function getHint(t){var n=null;n=t?JSON.stringify({hint:$("#input").val(),status:"ENTERED"}):JSON.stringify({hint:$("#input").val(),status:"HINT"}),stompClient.send("/app/getHint",{},n)}function sendIntent(t){console.log("Sending final intent"),stompClient.send("/app/intent",{},JSON.stringify(t))}function inputTextHint(t){$("#hint").text(t)}function showAlert(t){var n=$("#warning");n.text(t),n.css("opacity","1"),n.css("bottom","125%"),hasAlert=!0}function clearAlert(){var t=$("#warning");t.text(""),t.css("opacity","0"),t.css("bottom","0%"),hasAlert=!1}function clearUnknown(){var t=$("#info");t.text(""),t.css("opacity","0"),t.css("bottom","0%"),t.css("z-index","-1"),hasUnknown=!1}$(document).ready(function(){connect(),$("#input").keyup(function(t){return 13==t.which?(hasAlert&&clearAlert(),hasUnknown&&clearUnknown(),lastCommand=$("#input").val(),$("#hint").text(""),$("#hint").css("opacity","0"),getHint(!0),void $("#input").val("")):38==t.which||40==t.which?($("#input").val(lastCommand),void $("#hint").text(lastCommand)):void 0})});